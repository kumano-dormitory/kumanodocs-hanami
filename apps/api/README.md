# 資料システムAPI
目次
* ログイン関連
  - POST `/login/getToken`
* ブロック会議関連
  - GET `/meetings`
  - GET `/meetings/:id`
  - GET `/meetings/:id/pastMeeting`
* 議案関連
  - GET `/articles`
  - POST `/articles`
  - GET `/articles/:id`
  - POST `/articles/:id`
  - POST `/articles/:id/getLock`
  - GET `/search`
* ブロック会議の議事録関連
  - GET `/meetings/:meeting_id/comments`
* 寮生大会議事録関連
  - GET `/gijiroku`
  - POST `/gijiroku`

## ログイン関連
### POST `/login/getToken`
ユーザー名とパスワードを送信し、ログイン認証を行う. 認証が成功した場合は有効なJWTが返される

#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `username` | **必須** | ユーザー名 |
| `password` | **必須** | パスワード |

#### レスポンス
認証成功時のレスポンス:
```
{
  "response_code":200,
  "message":"OK",
  "response_body": {
    "token":__有効なJWT__
  }
}
```
認証失敗時のレスポンス
```
{"response_code":403,"message":"Forbidden"}
```

## ブロック会議関連
### GET `/meetings`
ブロック会議一覧を取得する. パラメータで特に指定しない場合は、直近の20のブロック会議のリストが返される
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `limit` | (任意)   | 取得したいブロック会議の数(最大値500). 初期値20. |
| `offset`| (任意)   | 開催日時降順における取得したいブロック会議の一覧へのオフセット. 初期値0. |

#### レスポンス
成功時のレスポンス:
```
{
  "meetings" : [
    {
      "id":__ブロック会議のid__,
      "date":__ブロック会議の日程__,
      "deadline"__ブロック会議の議案投稿締め切り日時__:
    },
    __ブロック会議のリスト__
  ]
}
```
失敗時のレスポンス: STATUS 400

### GET `/meetings/:id`
`:id`で指定されたidを持つブロック会議を取得する. ブロック会議に含まれる議案の情報も同時に返される.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `id`    | **必須** | 取得したいブロック会議のid (URL中で指定) |

#### レスポンス
成功時のレスポンス:
```
{
  "meeting": {
    "id": __ブロック会議のid__,
    "date": __ブロック会議の日程__,
    "deadline": __ブロック会議の議案投稿締切日時__,
    "articles": [
      {
        "id": __議案のid__,
        "title": __議案の題名__,
        "body": __議案本文__,
        "format": __議案のフォーマット__,
        "created_at": __議案の作成日時__,
        "updated_at": __議案の更新日時__,
        "author_name": __文責者名__,
        "checked": __通常議案か追加議案かのフラグ__,
        "printed": __資料委員会により印刷されるかのフラグ__,
        "number": __議案の番号（ブロック会議内で議案に割付される）__,
        "category_name": __議案種別(複数の種別がある場合は一つの文字列に連結される)__
      },
      __議案のリスト__
    ]
  }
}
```
失敗時のレスポンス: STATUS 400 or 404

### GET `/meetings/:id/pastMeeting`
`:id`で指定するブロック会議の一つ前のブロック会議を取得する.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `id`    | **必須** | ブロック会議のid. (URL中で指定). このidで指定されたブロック会議の直前のブロック会議のデータが返される. |

#### レスポンス
成功時のレスポンス
```
{
  "meeting": {
    "id": __ブロック会議のid__,
    "date": __ブロック会議の日程__,
    "deadline": __ブロック会議の議案投稿締切日時__,
    "type": __ブロック会議か寮生大会であるかのフラグ__,
    "created_at": __ブロック会議の作成日時__,
    "updated_at": __ブロック会議の更新日時__
  }
}
```
失敗時のレスポンス: STATUS 400 or 404

## 議案関連
### GET `/articles`
新着議案を取得する. 直近20ブロック会議の情報とともにグループ化されてデータが返される. 特に指定されない限り、直近の3つのブロック会議に含まれる議案の情報を返す.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `with_articles` | (任意) | 議案の情報を含めるブロック会議の数. 初期値3. |

#### レスポンス
成功時のレスポンス:
```
{
  "meetings":[
    {
      "id": __ブロック会議のid__,
      "date": __ブロック会議の日程__,
      "deadline": __ブロック会議の議案投稿締切日時__,
      "articles": [
        {
          "id": __議案のid__,
          "title": __議案の題名__,
          "body": __議案本文__,
          "format": __議案のフォーマット__,
          "created_at": __議案の作成日時__,
          "updated_at": __議案の更新日時__,
          "author_name": __文責者名__,
          "checked": __通常議案か追加議案かのフラグ__,
          "printed": __資料委員会により印刷されるかのフラグ__,
          "number": __議案の番号（ブロック会議内で議案に割付される）__,
          "category_name": __議案種別(複数の種別がある場合は一つの文字列に連結される)__
        },
        __議案のリスト__
      ]
    },
    __ブロック会議のリスト__
  ]
}
```
失敗時のレスポンス: STATUS 400

### POST `/articles`
議案を新規投稿する.
### リクエストパラメータ
| パラメータ名 | 必須or任意 | 型 | 詳細 |
| ---------- | --- | --- | --- |
| `token` | **必須** | string | 有効なJWT |
| `meeting_id` | **必須** | int | 議案の投稿先として指定するブロック会議のid |
| `categories` | **必須** | int array | 議案種別のidの配列 |
| `title` | **必須** | string | 議案の題名 |
| `author_name` | **必須** | string | 文責者名 |
| `password` | **必須** | string | 議案のパスワード（編集時の認証用） |
| `format` | **必須** | int | 議案のフォーマット(通常は0) |
| `body` | **必須** | string | 議案の本文 |
| `vote_content` | (任意) | string | 採決項目（議案種別が採決または採決予定を含んでいる場合のみ） |
| `same_refs` | (任意) | int array | 過去のブロック会議に投稿された同じ議案のidの配列 |
| `other_refs` | (任意) | int array | 過去のブロック会議に投稿された関連議案のidの配列 |

### レスポンス
成功時のレスポンス
```
{
  "response_code":200,
  "message":"OK",
  "response_body": {
    "status":"Success",
    "message": __通常議案・追加議案のどちらで投稿されたかのメッセージ__
  }
}
```
失敗時のレスポンス
```
{
  "response_code":422,
  "message":"Unprocessable Entity",
  "response_body": {
    "status":"Error:",
    "message": __エラー詳細のメッセージ__
  }
}
```

### GET `/articles/:id`
`:id`で指定する議案の情報を取得する. 指定された議案に関する詳細なデータを返す.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `id`    | **必須** | 取得したい議案のid (URL中で指定) |

#### レスポンス
成功時のレスポンス:
```
{
  "article": {
    "id": __議案のid__,
    "title": __議案の題名__,
    "body": __議案本文__,
    "format": __議案のフォーマット__,
    "created_at": __議案の作成日時__,
    "updated_at": __議案の更新日時__,
    "author_name": __文責者名__,
    "checked": __通常議案か追加議案かのフラグ__,
    "printed": __資料委員会により印刷されるかのフラグ__,
    "number": __議案の番号（ブロック会議内で議案に割付される）,
    "meeting_id": __議案が含まれるブロック会議のid__,
    "meeting_date": __議案が含まれるブロック会議日程__,
    "meeting_deadline": __議案が含まれるブロック会議の投稿締切日時__,
    "categories": [
      {
        "id": __議案種別と議案の関連情報のid__,
        "extra_content": __議案種別に関連した追加情報（採決項目など）__,
        "created_at": __議案種別と議案の関連情報の作成日時__,
        "updated_at": __議案種別と議案の関連情報の更新日時__,
        "category_name": __議案種別の名前__,
        "require_content": __議案種別が追加情報を含んでいるかのフラグ__
      },
      __議案種別のリスト__
    ],
    "comments": [
      {
        "id": __議事録のid__,
        "body": __議事録の本文__,
        "created_at": __議事録の作成日時__,
        "updated_at": __議事録の更新日時__,
        "block_id": __議事録を投稿したブロックのid__,
        "block_name": __議事録を投稿したブロック名__
      },
      __議事録のリスト__
    ],
    "vote_results": [
      {
        "id": __採決結果のid__,
        "agree": __賛成の数__,
        "disagree": __反対の数__,
        "onhold": __保留の数__,
        "block_id": __採決を行ったブロックのid__,
        "block_name": __採決を行ったブロック名__
      },
      __採決結果のリスト__
    ],
    "tables": [
      {
        "id": __表のid__,
        "caption": __表の題名__,
        "csv": __表のデータ(TSV形式)__,
        "created_at": __表の作成日時__,
        "updated_at": __表の更新日時__
      },
      __表のリスト__
    ],
    "messages": [
      {
        "id": __議事録への返答のid__,
        "body": __議事録への返答の本文__,
        "comment_id": __返答対象の議事録のid__,
        "send_by_article_author": __議案提起者による返答であるかのフラグ__,
        "block_name": __返答対象の議事録を投稿したブロック名__
      },
      __議事録への返答のリスト__
    ]
  }
}
```
失敗時のレスポンス: STATUS 404

### POST `/articles/:id`
`:id`で指定された議案を更新する.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 型 | 詳細 |
| ---------- | --- | --- | --- |
| `token` | **必須** | string | 有効なJWT |
| `id` | **必須** | int | 更新を行う議案のid |
| `meeting_id` | **必須** | int | 議案の投稿先のブロック会議のid |
| `categories` | **必須** | int array | 議案種別のidの配列 |
| `title` | **必須** | string | 議案の題名 |
| `author_name` | **必須** | string | 文責者名 |
| `format` | **必須** | int | 議案のフォーマット(通常は0) |
| `body` | **必須** | string | 議案の本文 |
| `vote_content` | (任意) | string | 議案の清潔項目（議案種別に採決または採決予定を含む場合のみ）|
| `same_refs` | (任意) | int array | 過去のブロック会議に投稿された同じ議案のidの配列 |
| `other_refs` | (任意) | int array | 過去のブロック会議に投稿された関連議案のidの配列 |
| `lock_key` | **必須** | string | 議案の編集ロックのキー（認証の成功時に返されるキー) |
| `get_lock` | **必須** | bool | 議案の編集ロックのキーがない（または有効ではない）場合に、パスワードで認証を行うかのフラグ |
| `password` | (任意) | string | 議案のパスワード（`get_lock`が`true`の場合のみ）|

#### レスポンス
成功時のレスポンス
```
{
  "response_code":200,
  "message":"OK",
  "response_body": {
    "status":"Success",
    "message":"正常に議案が編集されました."
  }
}
```
失敗時のレスポンス
```
{
  "response_code": __エラーコード(HTTP STATUS CODE)__,
  "message": __エラーコードの説明__,
  "response_body": {
    "status":"Error",
    "message": __エラー詳細のメッセージ__
  }
}
```

### GET `/articles/:id/checkLock`
`:id`で指定する議案の編集ロックが既に取られているか確認する. 編集ロックの獲得状態のデータを返す.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `id` | **必須** | 議案のid（URL中で指定） |

#### レスポンス
成功時のレスポンス
```
{
  "response_code":200,
  "message":"OK",
  "response_body": {
    "id": __議案のid__,
    "locked": __議案の編集ロックの状態（trueならばロック済み）__
  }
}
```
失敗時のレスポンス
```
{
  "response_code":422,
  "message":"Unprocessable Entity",
  "response_body": {
    "status":"Error",
    "message":"入力された項目に不備があります."
  }
}
```

### POST `/articles/:id/getLock`
`:id`で指定する議案の編集ロックを取得する. 認証に成功した場合は編集ロックのキー（議案の更新時に必要）を返す.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `id` | **必須** | 議案のid（URL中で指定） |
| `password` | **必須** | 議案のパスワード |

#### レスポンス
成功時のレスポンス
```
{
  "response_code":200,
  "message":"OK",
  "response_body": {
    "status":"Success",
    "message":"正常に認証されました."
    "lock_key": __編集ロックのキー__
  }
}
```
失敗時のレスポンス
```
{
  "response_code": __エラーコード（HTTP STATUS CODE）__,
  "message": __エラーコードの説明__,
  "response_body": {
    "status":"Error",
    "message": __エラーの詳細__
  }
}
```

### GET `/search`
議案を検索し、一覧を取得する.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `q`     | (任意) | 検索キーワード |
| `limit` | (任意) | 取得したい議案の数(最大値100). 初期値25. |
| `offset`| (任意) | limitで制限される議案へのオフセット. 初期値0. |

#### レスポンス
成功時のレスポンス
```
{
  "articles": [
    {
      "id": __議案のid__,
      "title": __議案の題名__,
      "body": __議案本文__,
      "format": __議案のフォーマット__,
      "created_at": __議案の作成日時__,
      "updated_at": __議案の更新日時__,
      "checked": __通常議案か追加議案かのフラグ__,
      "printed": __資料委員会により印刷されるかのフラグ__,
      "number": __議案の番号（ブロック会議内で議案に割付される）__,
      "author_name": __文責者名__,
      "meeting_date": __議案が含まれるブロック会議日程__,
      "meeting_deadline": __議案が含まれるブロック会議の投稿締切日時__,
      "category_name": __議案種別(複数の種別がある場合は一つの文字列に連結される)__
    },
    __議案のリスト__
  ]
}
```
失敗時のレスポンス: STATUS 400

## ブロック会議の議事録関連
### GET `/meetings/:meeting_id/comments`
`:meeting_id`で指定したブロック会議に含まれる議事録・採決結果を全て取得する.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `meeting_id` | **必須** | 指定するブロック会議のid. (URL中で指定) |

#### レスポンス
成功時のレスポンス
```
{
  "meeting": {
    "id": __ブロック会議のid__,
    "date": __ブロック会議の日程__,
    "deadline": __ブロック会議の議案投稿締切日時__,
    "comments": [
      {
        "block_id": __議事録を投稿したブロックのid__,
        "block_name": __議事録を投稿したブロック名__,
        "title": __(議事録の対象の)議案の題名__,
        "article_id": __(議事録の対象の)議案のid__,
        "article_number" __(議事録の対象の)議案の順序番号__,
        "id": __議事録または採決結果のid(このidの値は使用しないこと)__,
        "body": __議事録の本文__,
        "agree": __賛成の数__,
        "disagree": __反対の数__,
        "onhold": __保留の数__
      },
      __議事録（採決結果含む）のリスト__
    ],
    "messages": [
      {
        "id": __議事録への返答のid__,
        "body": __議事録への返答の本文__,
        "send_by_article_author": __議案提起者による返答であるかのフラグ__,
        "article_id": __返答対象の議事録が投稿された議案のid__,
        "article_number": __返答対象の議事録が投稿された議案の順序番号__,
        "comment_id": __返答対象の議事録のid__
      },
      __議事録への返答のリスト__
    ]
  }
}
```
失敗時のレスポンス: STATUS 400

## 寮生大会議事録関連
### GET `/gijiroku`
寮生大会議事録を取得する.
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |

#### レスポンス
成功時のレスポンス
```
{
  "id": __寮生大会議事録のid__,
  "body": __寮生大会議事録の本文__
}
```

### POST `/gijiroku`
寮生大会議事録を送信する(更新する).
#### リクエストパラメータ
| パラメータ名 | 必須or任意| 詳細 |
| ---------- | --- | --- |
| `token` | **必須** | 有効なJWT |
| `content` | **必須** | 寮生大会議事録の本文 |

#### レスポンス
成功時のレスポンス
```
{
  "response_code":200,
  "message":"OK",
  "response_body": {
    "id": __更新された寮生大会議事録のid__
  }
}
```
失敗時のレスポンス: STATUS 422
```
{"response_code":422,"message":"Unprocessable Entity"}
```
